name: Verify Docker Images

on: [push, pull_request]

jobs: 
  verify-corretto:
    name: Verify Corretto JDK Images
    runs-on: ubuntu-latest
    strategy:
      matrix:
        version-package: [8-jdk, 11-jdk, 15-jdk, 15-slim]
        platform: [alpine, al2, debian]
    steps:
      - name: Checkout code
        uses: actions/checkout@v2
      - name: Test Corretto-${{ matrix.version }} on ${{ matrix.platform }}
        run: |
          PLATFORM="${{ matrix.platform }}"
          VERSION_PACKAGE="${{ matrix.version-package }}"
          IFS='-' read VERSION PACKAGE <<<$VERSION_PACKAGE
          DOCKER_FILE="${VERSION}/${PACKAGE}/${PLATFORM}/Dockerfile"
          echo "Testing docker image ${DOCKER_FILE}..."
          ./bin/test-image.sh "${DOCKER_FILE}"

  verify-corretto-jre:
    name: Verify Corretto JRE Images
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v2
      - name: Test Corretto-8 JRE on Alpine
        run: ./bin/test-image.sh 8/jre/alpine/Dockerfile